# 🧪 Baryon Mass, Sigma-Term and Trace Anomaly Analysis from Lattice QCD

This repository provides scripts, input files, and plotting utilities necessary for extracting baryon and meson masses, effective masses, sigma terms and trace anomaly contributions from 2-point correlation functions data generated in lattice QCD simulations.

---

## 📁 Repository Structure

```
.
├── bootstrap_and_plot_*/        # Scripts for fitting 2-point correlators (effective mass extraction)
├── global_fit/                  # Physical and chiral extrapolation scripts
├── final_results/               # Scripts for generating final plots and JSON results
├── params/                      # Ensemble parameters, initial fit priors, and environment configuration
├── temp/                        # Intermediate outputs (PNG, PDF, NumPy arrays; auto-generated, not for manual use)
├── utils/                       # Common utilities (plotting styles, I/O functions)
├── *.sh                         # Launcher scripts for running various analysis stages
```

---

## ⚙️ Installation & Data Setup (Docker)

The complete analysis workflow is provided in a Docker image:

```bash
docker pull ghcr.io/hubl1/baryon-analysis:latest

docker run --rm -it -v /path/to/lqcd_data:/lqcd_data_path ghcr.io/hubl1/baryon-analysis:latest bash
```

Ensure your `/lqcd_data_path` contains the raw `.h5` files of your 2-point correlator data. Set the path to `$lqcd_data_path` in the file:

```
params/env.sh
```

---

## 📦 Getting the Input Data

You can download a complete archive of `lqcd_data` (\~32 GB) with the following command:

```bash
curl -f -C - -o lqcd_data.tar.gz \
  https://ksefile.hpccube.com:65241/efile/share/L3B1YmxpYy9ob21lL2h1Ymw=/8iadVJCqq

# Then extract it

tar -xvzf lqcd_data.tar.gz
```

The unpacked structure looks like:

```
lqcd_data/
├── baryon_meson_data_h5           # Raw 2-point correlators (~25 GB)
├── precomputed_Propagators        # Precomputed propagators (~3.3 GB, for chroma-meas Docker image)
├── precomputed_pydata_eff_mass    # Effective mass fit results (~3.1 GB)
├── precomputed_pydata_global_fit  # Global fit data (~18 MB)
```

Set the path in `params/env.sh`:

```bash
export lqcd_data_path=/absolute/path/to/lqcd_data
```

---

## 🚀 Quick Start

Run each command from the repository root to reproduce the entire analysis pipeline:

### Light and Charmed Baryon/Meson 2-point Fits

```bash
./light_baryon_2pt.sh <ensemble_id> <mode>
./charmed_baryon_2pt.sh <ensemble_id> <mode>
```

* `ensemble_id`: Integer 0–14 (defined in `params/ensemble_info.sh`)
* `mode`:

  * `0`: Unitary point (valence quark masses equal to sea quark masses)
  * `1`: All possible valence quark combinations (light, strange, charm)

**Example:**

```bash
./light_baryon_2pt.sh 1 0   # Perform fit for ensemble 1 (C24P29), mode 0 (unitary)
```

### Light and Charm Quark 2-point Fits (PCAC mass and decay constants)

```bash
./light_quark_2pt.sh <ensemble_id> <mode>
./charm_quark_2pt.sh <ensemble_id> <mode>
```

**Example:**

```bash
./charm_quark_2pt.sh 3 1  # Perform charm quark analysis for ensemble 3 with all valence combinations
```

### Global Fits (Physical/Chiral Extrapolation)

```bash
./light_baryon_global_fit.sh
./charmed_baryon_global_fit.sh
```

These scripts perform global fits using various systematic variations to build a comprehensive error budget.

### Final Results Generation

```bash
./final_results.sh
```

This generates final publication-quality plots and JSON data.

---

## 🔢 Inputs & Configuration

* **Fit priors**: JSON files located in `params/fit_init_values/*.json`
* **Ensemble definitions** (beta, mu, ms, volumes, names): `params/ensemble_info.sh`
* **Data paths**: Configured in `params/env.sh`

---

## 📟 Output Summary

| Location                               | File Type | Description                                      |
| -------------------------------------- | --------- | ------------------------------------------------ |
| `$lqcd_data_path/final_results/*.pdf`  | PDF       | Final analysis and comparison plots              |
| `$lqcd_data_path/final_results/*.json` | JSON      | Machine-readable tables for masses & sigma terms |

Intermediate and final analysis results reside under the mounted `$lqcd_data_path`:

```
/lqcd_data_path
├── baryon_meson_data_h5           # Raw 2-point data (.h5 files)
├── precomputed_Propagators        # For chroma-meas Docker image test
├── precomputed_pydata_eff_mass    # Precomputed effective masses
├── precomputed_pydata_global_fit  # Precomputed global fit data
├── pydata_eff_mass                # Effective masses generated by scripts
├── pydata_global_fit              # Global fit data generated by scripts
├── final_results                  # Final outputs (PDF, JSON)
├── figures                        # Additional analysis plots
```

---

## 📖 Explanation of Fit Variations (Global Fit)

* **`None`**: Default fit including all statistical and systematic errors
* **`mpi`**: Exclude statistical error of pion mass (`m_pi`) to estimate statistical uncertainties
* **`metas`**: Exclude statistical error of `eta_s` meson mass to estimate statistical uncertainties
* **`D_S`** (charmed fits only):  Shift `D_s` mass by 1-sigma to estimate systematic uncertainties
* **`alttc_stat`**: Exclude statistical error of lattice spacing to estimate statistical uncertainties
* **`alttc_sys`**: Shift lattice spacing (`w0`) by 1-sigma to estimate systematic uncertainties

These variations allow estimation of a comprehensive error budget for physical predictions.

---

## 🐳 Docker Notes

The complete workflow is bundled and distributed via Docker, ensuring consistent analysis environments across different computing systems.

